# 나비얌 (Naviyam) 프로젝트 구조 분석

## 프로젝트 개요

**나비얌(Naviyam)**은 어린이를 위한 한국어 AI 챗봇 시스템으로, "착한가게" 추천에 특화된 대화형 AI입니다. 고도화된 추천 엔진과 지속적 학습 기능을 결합하여 아이들에게 적절한 음식점과 메뉴 옵션을 추천합니다.

## 디렉토리 구조

```
chat_bot+recommd/
├── main.py                          # 메인 애플리케이션 진입점
├── train.py                         # 모델 훈련 스크립트
├── api/                             # REST API 서버
│   ├── server.py                    # FastAPI 기반 웹 서버
│   └── README.md                    # API 문서
├── data/                            # 데이터 관리 모듈
│   ├── data_loader.py               # 데이터 로딩 및 전처리
│   ├── data_structure.py            # 데이터 구조 정의
│   ├── restaurants_optimized.json   # 최적화된 음식점 데이터
│   └── *.md                         # 데이터 분석 보고서들
├── models/                          # AI 모델 관리
│   ├── model_factory.py             # 모델 팩토리 (KoAlpaca, A.X 3.1 Lite)
│   ├── ax_model.py                  # SKT A.X 모델 구현
│   ├── koalpaca_model.py            # KoAlpaca 모델 구현
│   └── models_config.py             # 모델 설정
├── inference/                       # 추론 및 대화 처리
│   ├── chatbot.py                   # 메인 챗봇 엔진
│   ├── response_generator.py        # 응답 생성기
│   ├── user_manager.py              # 사용자 관리
│   └── data_collector.py            # 학습 데이터 수집
├── recommendation/                  # 2단계 추천 시스템
│   ├── recommendation_engine.py     # 메인 추천 엔진
│   ├── candidate_generator.py       # 후보 생성기
│   ├── collaborative_funnel.py      # 협업 필터링
│   ├── content_funnel.py            # 콘텐츠 기반 필터링
│   ├── contextual_funnel.py         # 상황 기반 필터링
│   ├── popularity_funnel.py         # 인기도 기반 필터링
│   ├── ranking_model.py             # Wide & Deep 순위 모델
│   └── feature_engineering.py       # 특성 엔지니어링
├── rag/                             # 검색 증강 생성 시스템
│   ├── retriever.py                 # 벡터 검색 및 문서 검색
│   ├── vector_stores.py             # FAISS, ChromaDB 통합
│   ├── documents.py                 # 문서 관리
│   ├── query_parser.py              # 쿼리 구조화
│   └── test_data*.json              # 테스트 데이터
├── nlp/                             # 자연어 처리
│   ├── nlu.py                       # 자연어 이해
│   ├── nlg.py                       # 자연어 생성
│   ├── preprocessor.py              # 전처리기
│   └── llm_normalizer.py            # LLM 정규화
├── training/                        # LoRA 훈련 시스템
│   ├── lora_trainer.py              # LoRA 어댑터 훈련
│   ├── lora_trainer_core.py         # 핵심 훈련 로직
│   ├── lora_evaluator.py            # 성능 평가
│   ├── lora_scheduler.py            # 훈련 스케줄링
│   ├── lora_deployment_manager.py   # 배포 관리
│   ├── fine_tuner.py                # 파인튜닝 도구
│   └── data_generator.py            # 훈련 데이터 생성
├── nutrition/                       # 영양 정보 API
│   ├── api_client.py                # 외부 API 클라이언트
│   └── data_processor.py            # 영양 데이터 처리
├── utils/                           # 유틸리티 모듈
│   ├── config.py                    # 설정 관리
│   ├── logging_utils.py             # 로깅 유틸리티
│   ├── emoji_manager.py             # 이모지 관리
│   └── welcome_message.py           # 환영 메시지
└── tests/                           # 테스트 스위트
    ├── simple_test_runner.py        # 테스트 실행기
    ├── test_*.py                    # 다양한 테스트 스크립트
    └── *.md                         # 테스트 결과 보고서
```

## 핵심 컴포넌트

### 1. 메인 애플리케이션 (`main.py`)
- **다중 모드 지원**: 채팅, 추론, 평가, 훈련 모드
- **대화형 인터페이스**: 한국어 대화 인터페이스와 사용자 프로파일링
- **성능 모니터링**: 응답 시간 최적화를 위한 메트릭 추적
- **데이터 수집**: 지속적 개선을 위한 자동 학습 데이터 수집

### 2. API 서버 (`api/server.py`)
- **FastAPI 기반**: 자동 문서화를 지원하는 전문적인 웹 API
- **엔드포인트**: 채팅, 사용자 관리, 대화 히스토리, 헬스체크, 메트릭
- **에러 처리**: 한국어 사용자 친화적 메시지와 포괄적 에러 핸들링
- **CORS 지원**: 웹 통합을 위한 교차 출처 리소스 공유

### 3. 모델 팩토리 (`models/model_factory.py`)
- **다중 모델 지원**:
  - **KoAlpaca 5.8B**: 전통적인 한국어 모델 (안정적, 빠름)
  - **A.X 3.1 Lite 7B**: SKT의 한국어 특화 모델 (고품질, 나비얌 최적화)
- **LoRA 지원**: LoRA 어댑터를 이용한 파인튜닝 기능
- **메모리 최적화**: 제한된 VRAM을 위한 4비트 양자화 지원

### 4. 고도화된 추천 엔진 (`recommendation/recommendation_engine.py`)

#### **2단계 추천 시스템**:

**1단계 - 다중 펀넬 후보 생성**:
- **Collaborative Funnel**: 사용자 행동 기반 추천
- **Content Funnel**: 벡터 검색 기반 의미적 매칭 (우선순위)
- **Contextual Funnel**: 시간, 위치, 상황 기반 필터링
- **Popularity Funnel**: 트렌딩 및 인기 아이템

**2단계 - Wide & Deep 개인화**:
- **Wide 컴포넌트**: 실제 데이터베이스 스키마(31개 시트)를 사용한 교차곱 특성
- **Deep 컴포넌트**: 수치적 특성을 가진 임베딩 특성
- **데이터 편향 보정**: 착한가게(10% 편향), 급식카드(90% 편향), 인기메뉴(100% 편향) 문제 해결

### 5. RAG 시스템 (`rag/retriever.py`)
- **검색 증강 생성**: 관련 지식 베이스 정보로 응답 향상
- **벡터 스토어 통합**: FAISS, ChromaDB, Mock 구현 지원
- **쿼리 구조화**: 자연어를 구조화된 쿼리로 변환
- **문서 관리**: 메타데이터를 포함한 상점 및 메뉴 문서 처리

### 6. 챗봇 코어 (`inference/chatbot.py`)
- **통합 파이프라인**: NLU, NLG, 추천, RAG 결합
- **스마트 처리**: 복잡한 입력을 위한 LLM 향상 NLU
- **사용자 전략 관리**: 사용자 경험에 따른 다양한 모드 (온보딩, 일반)
- **성능 최적화**: 3초 초기화 목표와 상세한 성능 모니터링

### 7. LoRA 훈련 시스템 (`training/lora_trainer.py`)
- **자동화된 훈련**: 사용자 상호작용에서 지속적 학습
- **품질 필터링**: 고품질 대화 데이터만 훈련에 사용
- **성능 평가**: 자동 어댑터 테스트 및 배포
- **스케줄링**: 리소스 관리를 포함한 설정 가능한 훈련 간격

## 주요 기술 스택

### **머신러닝 스택**:
- **PyTorch**: 딥러닝 프레임워크
- **Transformers**: Hugging Face 트랜스포머 라이브러리
- **PEFT**: LoRA 구현을 위한 파라미터 효율적 파인튜닝
- **FAISS**: 벡터 유사도 검색
- **SentenceTransformers**: 텍스트 임베딩

### **NLP 및 한국어 지원**:
- **KoAlpaca**: 한국어 언어 모델
- **A.X 3.1 Lite**: SKT의 한국어 특화 모델
- **Custom NLU/NLG**: 한국어 특화 자연어 처리

### **웹 및 API**:
- **FastAPI**: 현대적인 Python 웹 프레임워크
- **Uvicorn**: ASGI 서버
- **Pydantic**: 데이터 검증 및 직렬화

## 어린이를 위한 특별 기능

### **어린이 친화적 설계**:
- **간단한 언어**: 연령에 적합한 어휘와 표현
- **친근한 톤**: 따뜻하고 격려하는 대화 스타일
- **윤리적 초점**: "착한가게" 개념 강조
- **안전 고려사항**: 적절한 콘텐츠 필터링
- **대화형 가이드**: 단계별 도움말 및 제안

### **온보딩 시스템**:
- **점진적 프로파일링**: 점진적인 선호도 학습
- **적응형 인터페이스**: 사용자 친숙도에 따른 변화
- **참여 기능**: 환영 메시지, 후속 질문

## 성능 및 확장성

### **최적화 기능**:
- **3초 초기화 목표**: 최적화된 컴포넌트 로딩
- **메모리 관리**: 자동 정리 및 리소스 최적화
- **캐싱**: 빠른 응답을 위한 모델 및 데이터 캐싱
- **양자화**: GPU 효율성을 위한 4비트 모델 양자화
- **비동기 처리**: 가능한 곳에서 논블로킹 작업

### **모니터링 및 분석**:
- **성능 메트릭**: 응답 시간, 성공률, 사용자 만족도 추적
- **학습 분석**: 데이터 수집 통계, 훈련 성능
- **시스템 헬스**: 컴포넌트 상태 모니터링 및 에러 추적

## 개발 및 테스트

### **종합적인 테스트**:
- **단위 테스트**: 개별 컴포넌트 테스트
- **통합 테스트**: 엔드투엔드 시스템 검증
- **성능 테스트**: 로드 및 응답 시간 테스트
- **품질 보증**: 데이터 품질 및 응답 적절성 테스트

### **개발 도구**:
- **디버그 모드**: 광범위한 로깅 및 디버깅 기능
- **관리자 인터페이스**: 개발 유틸리티 및 시스템 관리
- **설정 관리**: 유연한 매개변수 조정
- **핫 리로딩**: 개발 시 모델 및 설정 업데이트

## 데이터 플로우

### **사용자 상호작용 플로우**:
1. **입력 처리**: 텍스트 전처리 → NLU (의도/개체 추출)
2. **컨텍스트 구축**: 사용자 프로필 + 대화 히스토리 + 현재 컨텍스트
3. **RAG 향상**: 벡터 스토어에서 관련 지식 검색
4. **추천 생성**: 2단계 시스템 (후보 → 개인화된 순위)
5. **응답 생성**: 템플릿 기반 또는 LLM 향상 어린이 친화적 응답
6. **학습 데이터 수집**: 지속적 개선을 위한 자동 수집

### **훈련 파이프라인**:
1. **데이터 수집**: 실시간 대화 데이터 수집
2. **품질 필터링**: 자동화된 데이터 품질 평가
3. **LoRA 훈련**: 점진적 모델 개선
4. **성능 평가**: 자동화된 테스트 및 검증
5. **배포**: 개선된 모델의 조건부 배포

## 결론

이 프로젝트는 한국 어린이를 위해 특별히 설계된 정교한 프로덕션 수준의 대화형 AI 시스템으로, 고급 추천 기능과 지속적 학습 기능을 갖추고 있습니다. 아키텍처는 적절한 관심사 분리, 포괄적인 테스트, 어린이 안전 고려사항을 포함한 엔터프라이즈 수준의 엔지니어링을 보여줍니다.

편향 보정과 벡터 검색 우선순위를 가진 2단계 추천 시스템은 고급 ML 엔지니어링 관행을 보여주며, LoRA 기반 지속적 학습 시스템은 실제 사용자 상호작용에서 지속적인 개선을 가능하게 합니다.

이 시스템은 현대적인 AI 기술을 실용적인 배포 고려사항과 결합한 한국 시장의 어린이 중심 음식점 추천 서비스를 위한 잘 설계된 솔루션을 나타냅니다.